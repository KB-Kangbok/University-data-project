---
title: "Return on investment of Universities"
author: "KB Lee, Jason Lee, DeAndre King"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE, fig.height = 4, fig.width = 6 )
```


```{r}
library(tidyverse)
library(knitr)
```


```{r, cache=TRUE}
# read in data 
Colleges1 <- read.csv("https://ed-public-download.app.cloud.gov/downloads/Most-Recent-Cohorts-Scorecard-Elements.csv")
Colleges2 <- read.csv("https://ed-public-download.app.cloud.gov/downloads/Most-Recent-Cohorts-Treasury-Elements.csv")
Colleges3 <- read.csv("https://ed-public-download.app.cloud.gov/downloads/Most-Recent-Cohorts-All-Data-Elements.csv")
```

```{r}
names(Colleges1)[1] = "UNITID"
names(Colleges2)[1] = "UNITID"
names(Colleges3)[1] = "UNITID"

College_subset1 <- Colleges2 %>% select(MN_EARN_WNE_P6, COUNT_WNE_P6, UNITID, INSTNM)
College_subset2 <- Colleges3 %>% select(UNITID, ADM_RATE, TUITIONFEE_PROG, TUITFTE, RET_FT4, RET_FTL4, RET_PT4, RET_PTL4, WDRAW_ORIG_YR4_RT, REGION)
College_final <- inner_join(x = College_subset1, y = College_subset2, by = "UNITID")

College_final$INSTNM <- as.character(College_final$INSTNM)
College_final$MN_EARN_WNE_P6 <- as.numeric(as.character(College_final$MN_EARN_WNE_P6))
College_final$COUNT_WNE_P6 <- as.numeric(as.character(College_final$COUNT_WNE_P6))
College_final$ADM_RATE <- as.numeric(as.character(College_final$ADM_RATE))
College_final$TUITIONFEE_PROG <- as.numeric(as.character(College_final$TUITIONFEE_PROG))
College_final$TUITFTE <- as.numeric(as.character(College_final$TUITFTE))
College_final$RET_FT4 <- as.numeric(as.character(College_final$RET_FT4))
College_final$RET_FTL4 <- as.numeric(as.character(College_final$RET_FTL4))
College_final$RET_PT4 <- as.numeric(as.character(College_final$RET_PT4))
College_final$RET_PTL4 <- as.numeric(as.character(College_final$RET_PTL4))
College_final$WDRAW_ORIG_YR4_RT <- as.numeric(as.character(College_final$WDRAW_ORIG_YR4_RT))
```

In parsing through the US college data & sharing our individual questions of interest, our group decided to explore the dynamic relationship between the college institutions & their overall return on investment. We felt that this was an interesting topic to explore being that there are good amounts of concern & conversations around life & success after graduation; especially with that being depended on where you attend college. Is true that the return is greater based on the presteige of the college you attend or is that a myth? The specific factors (variables) that we wanted to take a closer look at were the overall tuition fees, retention & admission rates. We also wanted to incorporate the institution names, regions, & average earnings(salaries). 



### Figure 1. Line Plot on Admmission group

```{r}
College_tbl_data <- College_final %>% 
  mutate(adm_group = ifelse(ADM_RATE == 1, (ADM_RATE * 100) %/% 10 - 1 ,(ADM_RATE * 100) %/% 10)) %>%
  filter(!is.na(adm_group) & !is.na(MN_EARN_WNE_P6) & !is.na(COUNT_WNE_P6)) %>%
  group_by(adm_group) %>% 
  summarize(Avg_net_tuition = mean(TUITFTE, na.rm = TRUE),
            net_earning = sum(MN_EARN_WNE_P6 * COUNT_WNE_P6),
            net_employed = sum(COUNT_WNE_P6),
            Avg_earning = net_earning/net_employed
            )

ggplot(data = College_tbl_data) +
  geom_line(aes(x = adm_group, y = Avg_net_tuition), color = "steelblue", size = 1.1) +
  geom_line(aes(x = adm_group, y = Avg_earning), color = "red", size = 1.1) +
  theme_bw() +
  ylab("Modified average tuition & salary") +
  xlab("Admission rates quotient by 10") +
  geom_text(x = 7, y = 60000, label = "Salary line", color = "red") +
  geom_text(x = 1, y = 35000, label = "Tuition line", color = "steelblue") +
  ggtitle("Average tuition and Salary by admission group")
```


### Figure 2. Scatter Plot on net tuition and salary

```{r}
ggplot(data = College_final %>% filter(!is.na(ADM_RATE))) +
  geom_point(aes(x = log10(TUITFTE), y = MN_EARN_WNE_P6, color = ADM_RATE), alpha = 0.5) +
  xlab("Log net tuition") + ylab("Salary ($)") +
  ggtitle("Log net tuition vs Average Salary after graduation") +
  theme_bw()
```

### Figure 3. 

```{r}
CollegesSummary <- College_final %>%
  filter(REGION != 0 & !is.na(MN_EARN_WNE_P6) & !is.na(COUNT_WNE_P6)) %>%
  group_by(REGION) %>%
  summarize(Mean_Cost_of_Attendance = mean(TUITFTE, na.rm=TRUE),
            Min_Cost_of_Attendance = min(TUITFTE, na.rm=TRUE),
            Max_Cost_of_Attendance = max(TUITFTE, na.rm=TRUE),
            net_earning = sum(MN_EARN_WNE_P6 * COUNT_WNE_P6),
            net_employed = sum(COUNT_WNE_P6),
            Average_earning = net_earning/net_employed) %>%
  select(REGION, Mean_Cost_of_Attendance, Min_Cost_of_Attendance, Max_Cost_of_Attendance, Average_earning) %>%
  mutate(ROI = Average_earning - Mean_Cost_of_Attendance) %>%
  rename(
    Region = REGION
  )
  
kable(CollegesSummary %>% select(-ROI), caption= "Tuition Fees of Colleges in Different Regions")
```


### Figure 4. ROI grouped by region

```{r}
ggplot(data = CollegesSummary) +
  geom_bar(aes(x = factor(Region), y = ROI / 10000), stat = "identity", fill = "steelblue") +
  theme_bw() +
  ggtitle("Return on Investment by Region") +
  xlab("Region") +
  ylab("ROI ($10,000)") +
  ylim(c(0,3))
```

### Figure 5. Top 10 Universities

```{r}
top10Uni <- College_final %>%
  filter(INSTNM %in% c("Harvard University", "Cornell University", "University of Pennsylvania","Princeton University", "Yale University","Stanford University","University Of Michigan","Duke University","University of Georgia", "University of Notre Dame","Brown University")) %>%
  mutate(Category = ifelse(INSTNM %in% c("Harvard University", "Cornell University", "University of Pennsylvania","Princeton University", "Yale University"), "IVY", "D1")) %>%
  select(Category, REGION,INSTNM,ADM_RATE,RET_FT4, TUITFTE, MN_EARN_WNE_P6) %>%
  arrange(desc(Category)) %>%
  rename(
    Region = REGION,
    Institution = INSTNM,
    Admission_Rate = ADM_RATE,
    Retention_Rate = RET_FT4,
    Tuition = TUITFTE,
    Salary = MN_EARN_WNE_P6
  )

kable(top10Uni, caption = "Top 10 Universities, IVY vs D1")
```
